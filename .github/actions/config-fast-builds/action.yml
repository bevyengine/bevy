name: Configure faster builds
descrition: Uses `config_fast_builds.toml` to speed up compile times.
runs:
  using: composite
  steps:
    - name: Install prebuilt dependencies
      uses: BD103/bevy-prebuilt@main
      with:
        mold: ${{ runner.os == 'linux' }}
        sold: ${{ runner.os == 'macos' }}
        cargo-binutils: ${{ runner.os == 'windows' }}

    - name: Install llvm-tools
      if: ${{ runner.os == 'windows' }}
      shell: bash
      run: rustup component add llvm-tools

    - shell: bash
      run: echo /usr/local/bin >> $GITHUB_PATH

    - name: Enable faster linkers
      if: ${{ runner.os != 'windows' }} # LLD is already enabled on Windows
      shell: bash
      run: git apply .github/actions/config-fast-builds/enable-linkers.patch

    - name: Copy `config_fast_builds.toml` to `config.toml`
      shell: bash
      run: cp .cargo/{config_fast_builds,config}.toml
