---
title: BRP JSON Schema
pull_requests: [19786]
---

Previous version of Bevy Remote Protocol (BRP) introduced JSON Schema support. But the schema introduced was not a valid JSON Schema and using it as such would often produce invalid values.

Instead of custom format that looks kind like JSON Schema, we now follow Draft 2020 of JSON schema, as defined [here](https://json-schema.org/draft/2020-12/schema).
It is possible to use schemas generated by new system as validation data for assets in various editors.

JSON Schema export endpoint in RPC now instead of returning a map of strings to schemas it returns a single JSON Schema, where all of the schemas are stored in the `$defs` property.

Types identifiers are stored in `$defs` as strings, but when they are referenced from other types by `$ref` key they are percent encoded to take into account fact that they have to be valid URI and don't use reserved characters. That means that the type `glam::Vec3` is stored by `glam::Vec3` key in `$defs` and is referenced as `glam%3A%3AVec3` in other types.

There is added support for custom schemas for reflected types. One example of it are various glam types, which in Rust are represented as structs, but they are serialized into arrays of numbers. Since JSON Schema is a format for describing the structure of stored data, it now describes them as arrays of numbers. It is possible to get the information about the type by inspecting the additional `rustFieldsInfo` property. This property is provided when the type is serialized as array, but the type is not an array.

Example of changes:
Before:
```json
{
  "jsonrpc": "2.0",
  "id": 0,
  "result": {
    "bevy_input::mouse::AccumulatedMouseMotion": {
      "additionalProperties": false,
      "crateName": "bevy_input",
      "kind": "Struct",
      "modulePath": "bevy_input::mouse",
      "properties": {
        "delta": { "type": { "$ref": "#/$defs/glam::Vec2" } }
      },
      "reflectTypes": ["Resource", "Default", "Serialize", "Deserialize"],
      "required": ["delta"],
      "shortPath": "AccumulatedMouseMotion",
      "type": "object",
      "typePath": "bevy_input::mouse::AccumulatedMouseMotion"
    },
    "glam::Vec2": {
      "additionalProperties": false,
      "crateName": "glam",
      "kind": "Struct",
      "modulePath": "glam",
      "properties": {
        "x": { "type": { "$ref": "#/$defs/f32" } },
        "y": { "type": { "$ref": "#/$defs/f32" } }
      },
      "reflectTypes": ["Default", "Serialize", "Deserialize"],
      "required": ["x", "y"],
      "shortPath": "Vec2",
      "type": "object",
      "typePath": "glam::Vec2"
    }
  }
}
```

After:
```json
{
  "jsonrpc": "2.0",
  "id": 0,
  "result": {
    "$defs": {
      "bevy_input::mouse::AccumulatedMouseMotion": {
        "additionalProperties": false,
        "crateName": "bevy_input",
        "default": {
          "delta": [0.0, 0.0]
        },
        "description": "Tracks how much the mouse has moved every frame. This resource is reset to zero every frame. This resource sums the total [`MouseMotion`] events received this frame.",
        "kind": "Struct",
        "modulePath": "bevy_input::mouse",
        "properties": {
          "delta": {
            "$ref": "#/$defs/glam%3A%3AVec2",
            "description": "The change in mouse position.",
            "kind": "Struct",
            "title": "delta",
            "typePath": "glam::Vec2"
          }
        },
        "reflectTypeData": ["Default", "Serialize", "Deserialize", "Resource"],
        "required": ["delta"],
        "shortPath": "AccumulatedMouseMotion",
        "type": "object",
        "typePath": "bevy_input::mouse::AccumulatedMouseMotion"
      }
    },
    "glam::Vec2": {
      "crateName": "glam",
      "default": [0.0, 0.0],
      "kind": "Struct",
      "maxItems": 2,
      "minItems": 2,
      "modulePath": "glam",
      "prefixItems": [
        { "kind": "Value", "title": "x", "type": "number", "typePath": "f32" },
        { "kind": "Value", "title": "y", "type": "number", "typePath": "f32" }
      ],
      "reflectTypeData": ["Default", "Serialize", "Deserialize"],
      "rustFieldsInfo": {
        "x": { "kind": "Value", "title": "x", "type": "number", "typePath": "f32" },
        "y": { "kind": "Value", "title": "y", "type": "number", "typePath": "f32" }
      },
      "shortPath": "Vec2",
      "type": "array",
      "typePath": "glam::Vec2"
    }
  }
}
```
