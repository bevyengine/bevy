github:
  prebuilds:
    master: true
    branches: true
    pullRequests: true
    pullRequestsFromForks: true
    addCheck: false
    addComment: false
    addBadge: true

tasks:
  - name: Start web server
    command: python3 -m http.server --directory examples/wasm

  - name: Setup rust-analyzer for wasm target
    before: |
      sudo apt-get install --no-install-recommends -yq libasound2-dev libudev-dev
    init: |
      mkdir .vscode
      echo "{\"rust-analyzer.cargo.target\":\"wasm32-unknown-unknown\"}" > .vscode/settings.json

  - name: Install wasm tooling
    before: |
      rustup update
      rustup target add wasm32-unknown-unknown
      cargo install cargo-quickinstall
      cargo quickinstall wasm-bindgen-cli
      cargo quickinstall cargo-watch
    init: |
      cargo run -p build-wasm-example -- lighting

vscode:
  extensions:
    - matklad.rust-analyzer
